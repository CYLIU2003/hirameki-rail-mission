<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>救援列車ミッション | Kiosk</title>
  <link rel="stylesheet" href="/common.css"/>
  <style>
    .headerIcon{ width:28px; height:28px; vertical-align:-6px; margin-right:8px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="row" style="justify-content:space-between; align-items:flex-end;">
      <div>
        <div class="h1"><img class="headerIcon" src="/assets/train.svg" alt="">救援列車ミッション</div>
        <div class="muted">発車標ハッキングゲーム（操作端末）</div>
      </div>
      <div class="badge" id="connBadge">接続中…</div>
    </div>

    <div class="row" style="margin-top:12px;">
      <span class="badge" id="badgeKiosk"></span>
      <span class="badge" id="badgeInput"></span>
      <span class="badge" id="badgeMode"></span>
      <span class="badge" id="badgeDifficulty"></span>
    </div>

    <!-- ATTRACT -->
    <section id="S_ATTRACT" class="card" style="margin-top:14px;">
      <div class="h2">スタート</div>
      <div class="p">カードを引いたら番号（01〜30）を入力。カードが無ければ「デッキから開始」でOKです。</div>

      <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top:12px;">
        <div class="card">
          <div class="h2">カード番号</div>
          <input class="input" id="cardInput" inputmode="numeric" maxlength="2" placeholder="01〜30"/>
          <div class="row" style="margin-top:10px;">
            <button class="btn" id="btnCardClear">クリア</button>
            <button class="btn primary" id="btnStartWithId">この番号で開始</button>
          </div>
          <div class="muted" style="margin-top:8px;">ヒント：2桁（例：03）です。</div>
        </div>

        <div class="card">
          <div class="h2">スタッフ設定</div>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap:10px;">
            <div>
              <div class="muted">難易度</div>
              <select class="select" id="selDifficulty">
                <option value="EASY">EASY（成功体験）</option>
                <option value="NORMAL" selected>NORMAL（標準）</option>
                <option value="HARD">HARD（縛り）</option>
              </select>
            </div>
            <div>
              <div class="muted">モード</div>
              <select class="select" id="selMode">
                <option value="NORMAL" selected>NORMAL（10ステップ）</option>
                <option value="QUICK">QUICK（5ステップ）</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="btn primary big" id="btnStartDeck">デッキから開始（被りにくい）</button>
            <button class="btn danger" id="btnForceReset">強制リセット</button>
          </div>
          <div class="noteBox" style="margin-top:10px;">
            マウス用ショートカット：<span class="kbd">Enter</span> 発車 / <span class="kbd">Space</span> 次へ / <span class="kbd">R</span> リセット
          </div>
        </div>
      </div>
    </section>

    <!-- BRIEFING -->
    <section id="S_BRIEFING" class="card hidden" style="margin-top:14px;">
      <div class="h2" id="briefTitle">ミッション</div>
      <div class="p" id="briefText"></div>
      <hr/>
      <div class="grid" style="grid-template-columns: 1fr 1fr; gap:14px;">
        <div>
          <div class="muted">目的</div>
          <div class="p" id="briefObjective"></div>
          <div style="margin-top:10px;">
            <span class="badge warn"><img src="/assets/warning.svg" style="width:18px;height:18px;">ヒント</span>
            <span class="muted" id="briefHint"></span>
          </div>
        </div>
        <div>
          <div class="muted">縛り / 注意</div>
          <ul id="briefConstraints" style="margin:8px 0 0 18px; color:var(--muted); font-size:16px; line-height:1.55;"></ul>
        </div>
      </div>
      <div class="row" style="margin-top:14px; justify-content:flex-end;">
        <button class="btn" id="btnBackToAttract">戻る</button>
        <button class="btn primary big" id="btnToPlanning">作戦を組む</button>
      </div>
    </section>

    <!-- PLANNING -->
    <section id="S_PLANNING" class="card hidden" style="margin-top:14px;">
      <div class="h2">作戦（ルール）を2つまで選ぼう</div>
      <div class="muted">※「IF（条件）」が当てはまるときに「THEN（対策）」が発動します。</div>

      <div class="grid" style="grid-template-columns: 1fr 1fr; margin-top:12px;">
        <div class="card">
          <div class="h2">作戦①</div>
          <div class="muted">IF（条件）</div>
          <select class="select" id="rule1Cond"></select>
          <div class="muted" style="margin-top:10px;">THEN（対策）</div>
          <select class="select" id="rule1Act"></select>
          <div class="noteBox" id="rule1Desc" style="margin-top:10px;"></div>
        </div>

        <div class="card">
          <div class="h2">作戦②</div>
          <div class="muted">IF（条件）</div>
          <select class="select" id="rule2Cond"></select>
          <div class="muted" style="margin-top:10px;">THEN（対策）</div>
          <select class="select" id="rule2Act"></select>
          <div class="noteBox" id="rule2Desc" style="margin-top:10px;"></div>
          <div class="muted" style="margin-top:8px;" id="rule2Note"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="h2">いまのスコア（初期）</div>
        <div class="muted">出発後にどう変わるかは結果で見えるよ。</div>
        <div class="progressWrap" style="margin-top:10px;">
          <div class="progressRow">
            <div class="progressLabel">救援</div>
            <div class="progressBar"><div class="progressFill" id="kiosk_rescue_fill"></div></div>
            <div class="progressValue" id="kiosk_rescue_val"></div>
          </div>
          <div class="progressRow">
            <div class="progressLabel">混雑</div>
            <div class="progressBar"><div class="progressFill" id="kiosk_crowd_fill"></div></div>
            <div class="progressValue" id="kiosk_crowd_val"></div>
          </div>
          <div class="progressRow">
            <div class="progressLabel">遅延</div>
            <div class="progressBar"><div class="progressFill" id="kiosk_delay_fill"></div></div>
            <div class="progressValue" id="kiosk_delay_val"></div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:14px; justify-content:flex-end;">
        <button class="btn" id="btnPlanningBack">戻る</button>
        <button class="btn primary big" id="btnToReady">出発準備へ</button>
      </div>
    </section>

    <!-- READY -->
    <section id="S_READY" class="card hidden" style="margin-top:14px;">
      <div class="h2">出発進行！</div>
      <div class="p">大きいボタンで発車（EnterキーでもOK）。</div>
      <div class="center" style="margin-top:18px;">
        <button class="btn primary big" id="btnDepart">出発ボタン（Enter）</button>
      </div>
      <div class="row" style="margin-top:14px; justify-content:flex-end;">
        <button class="btn" id="btnReadyBack">作戦を直す</button>
      </div>
    </section>

    <!-- RUNNING -->
    <section id="S_RUNNING" class="card hidden" style="margin-top:14px;">
      <div class="h2">調整中…</div>
      <div class="muted">発車標の表示が切り替わるよ。しばらく待ってね。</div>
      <div class="progressWrap" style="margin-top:12px;">
        <div class="progressRow">
          <div class="progressLabel">救援</div>
          <div class="progressBar"><div class="progressFill" id="run_rescue_fill"></div></div>
          <div class="progressValue" id="run_rescue_val"></div>
        </div>
        <div class="progressRow">
          <div class="progressLabel">混雑</div>
          <div class="progressBar"><div class="progressFill" id="run_crowd_fill"></div></div>
          <div class="progressValue" id="run_crowd_val"></div>
        </div>
        <div class="progressRow">
          <div class="progressLabel">遅延</div>
          <div class="progressBar"><div class="progressFill" id="run_delay_fill"></div></div>
          <div class="progressValue" id="run_delay_val"></div>
        </div>
      </div>
      <div class="muted" style="margin-top:10px;">ステップ：<span id="runStep">0</span>/<span id="runTotal">10</span></div>
    </section>

    <!-- RESULT -->
    <section id="S_RESULT" class="card hidden" style="margin-top:14px;">
      <div class="h2" id="resultTitle">結果</div>
      <div class="p" id="resultReason"></div>
      <div class="row" style="margin-top:10px;">
        <span class="badge good" id="resultBadgeTotal">総合 0</span>
        <span class="badge" id="resultBadgeName">称号：-</span>
        <span class="badge" id="resultBadgeCode">コード：----</span>
      </div>
      <div class="progressWrap" style="margin-top:12px;">
        <div class="progressRow">
          <div class="progressLabel">救援</div>
          <div class="progressBar"><div class="progressFill" id="res_rescue_fill"></div></div>
          <div class="progressValue" id="res_rescue_val"></div>
        </div>
        <div class="progressRow">
          <div class="progressLabel">混雑</div>
          <div class="progressBar"><div class="progressFill" id="res_crowd_fill"></div></div>
          <div class="progressValue" id="res_crowd_val"></div>
        </div>
        <div class="progressRow">
          <div class="progressLabel">遅延</div>
          <div class="progressBar"><div class="progressFill" id="res_delay_fill"></div></div>
          <div class="progressValue" id="res_delay_val"></div>
        </div>
      </div>

      <div class="row" style="margin-top:14px; justify-content:flex-end;">
        <button class="btn" id="btnRetry">同じカードでもう一回</button>
        <button class="btn primary big" id="btnShowCert">復旧証明書へ</button>
      </div>
    </section>

    <!-- CERT -->
    <section id="S_CERT" class="card hidden" style="margin-top:14px;">
      <div class="h2">復旧証明書（写真OK）</div>
      <div class="card" style="margin-top:12px; border-radius:22px; position:relative; overflow:hidden;">
        <img src="/assets/pattern.svg" alt="" style="position:absolute; inset:0; opacity:0.18; width:100%; height:100%; object-fit:cover;">
        <div style="position:relative;">
          <div class="h1" style="margin:0; display:flex; align-items:center; gap:10px;">
            <img src="/assets/seal.svg" style="width:44px;height:44px;" alt="">
            運行復旧 証明書
          </div>
          <div class="muted" id="certWhen"></div>
          <hr/>
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap:14px;">
            <div>
              <div class="muted">ミッション</div>
              <div class="p" id="certMission"></div>
              <div class="muted" style="margin-top:10px;">称号</div>
              <div class="h2" id="certTitle"></div>
            </div>
            <div>
              <div class="muted">コード（ランキング用）</div>
              <div class="h1" id="certCode" style="letter-spacing:4px;"></div>
              <div class="muted">スコア（救援/混雑/遅延）</div>
              <div class="p" id="certScores"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:14px; justify-content:flex-end;">
        <button class="btn" id="btnNext">次の人へ（リセット）</button>
      </div>
    </section>
  </div>

  <script src="/catalog.js"></script>
  <script src="/common.js"></script>
  <script src="/kiosk.js"></script>
</body>
</html>